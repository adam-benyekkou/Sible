<div x-data="{ 
    show: {{ 'true' if show_default_password_warning and request.state.user.role == 'admin' else 'false' }},
    dismissed: false,
    dismiss() {
        this.dismissed = true;
        this.show = false;
        // Store dismissal in session storage (valid until browser/tab close)
        sessionStorage.setItem('defaultPasswordWarningDismissed', 'true');
    },
    checkDismissed() {
        if (sessionStorage.getItem('defaultPasswordWarningDismissed') === 'true') {
            this.show = false;
            this.dismissed = true;
        }
    }
}" 
x-init="checkDismissed()"
class="default-password-modal" 
:class="{ 'open': show && !dismissed }">
    
    <article style="max-width: 550px; position: relative; z-index: 1;">
        
        <header style="position: relative; display: flex; align-items: flex-start; gap: 1rem; border-bottom: none; padding-bottom: 1.5rem; border-bottom: 1px solid var(--border-subtle);">
            <!-- Warning Icon -->
            <div style="flex-shrink: 0; width: 48px; height: 48px; border-radius: 50%; background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); display: flex; align-items: center; justify-content: center;">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#D97706" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                    <line x1="12" y1="9" x2="12" y2="13"></line>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
            </div>
            
            <div style="flex: 1;">
                <h3 style="margin: 0; color: var(--ds-gray-1000); font-size: 1.25rem; font-weight: 600;">Security Warning: Default Password Detected</h3>
                <p style="margin: 0.5rem 0 0 0; color: var(--ds-gray-600); font-size: 0.9rem; line-height: 1.5;">
                    You are currently using the default password for your account. This is a critical security risk.
                </p>
            </div>
            
            <button type="button" aria-label="Close" @click="dismiss()"
                style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--ds-gray-600); line-height: 1; padding: 0; margin-left: auto;">&times;</button>
        </header>

        <div style="padding: 1.5rem 0;">
            <!-- Risk Explanation -->
            <div style="background: var(--surface-secondary); border-left: 4px solid #F59E0B; padding: 1rem 1.25rem; border-radius: 6px; margin-bottom: 1.5rem;">
                <h4 style="margin: 0 0 0.5rem 0; color: var(--ds-gray-1000); font-size: 0.95rem; font-weight: 600; display: flex; align-items: center; gap: 0.5rem;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#F59E0B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                    Why This Matters
                </h4>
                <p style="margin: 0; color: var(--ds-gray-700); font-size: 0.875rem; line-height: 1.6;">
                    Default credentials are publicly known and make your Sible instance vulnerable to unauthorized access. An attacker could execute Ansible playbooks, modify infrastructure, or access sensitive data.
                </p>
            </div>

            <!-- Action Steps -->
            <div style="margin-bottom: 1.5rem;">
                <h4 style="margin: 0 0 1rem 0; color: var(--ds-gray-1000); font-size: 0.95rem; font-weight: 600;">Immediate Action Required:</h4>
                <ol style="margin: 0; padding-left: 1.25rem; color: var(--ds-gray-700); font-size: 0.875rem; line-height: 1.8;">
                    <li style="margin-bottom: 0.5rem;"><strong>Navigate to Settings</strong> â†’ <strong>Users</strong></li>
                    <li style="margin-bottom: 0.5rem;"><strong>Edit your account</strong> and set a strong, unique password</li>
                    <li style="margin-bottom: 0.5rem;"><strong>Change all other default accounts</strong> (operator, watcher)</li>
                    <li><strong>Use a password manager</strong> to generate and store secure passwords</li>
                </ol>
            </div>

            <!-- Password Requirements -->
            <div style="background: var(--surface-tertiary); padding: 1rem 1.25rem; border-radius: 6px; border: 1px solid var(--border-subtle);">
                <h4 style="margin: 0 0 0.5rem 0; color: var(--ds-gray-1000); font-size: 0.875rem; font-weight: 600;">Strong Password Checklist:</h4>
                <ul style="margin: 0; padding-left: 1.25rem; color: var(--ds-gray-600); font-size: 0.8125rem; line-height: 1.6;">
                    <li>Minimum 12 characters</li>
                    <li>Mix of uppercase, lowercase, numbers, and symbols</li>
                    <li>No dictionary words or personal information</li>
                    <li>Unique to this application</li>
                </ul>
            </div>
        </div>

        <footer style="display: flex; gap: 0.75rem; justify-content: flex-end; border-top: 1px solid var(--border-subtle); padding-top: 1.5rem;">
            <button type="button" @click="dismiss()" 
                style="background: var(--surface-secondary); border: 1px solid var(--border-subtle); color: var(--ds-gray-700); padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.875rem; font-weight: 500;">
                I'll Do This Later
            </button>
            <button type="button" @click="dismiss(); window.location.href='/settings/users'" 
                class="primary" 
                style="padding: 0.5rem 1.25rem; font-size: 0.875rem; font-weight: 600; display: flex; align-items: center; gap: 0.5rem;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
                Change Password Now
            </button>
        </footer>
    </article>

    <!-- Modal Background -->
    <div class="modal-backdrop" @click="dismiss()"></div>
</div>

<style>
    .default-password-modal {
        display: none;
    }

    .default-password-modal.open {
        display: flex;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 9999;
        justify-content: center;
        align-items: center;
        animation: modalFadeIn 0.3s ease-out;
    }

    .default-password-modal.open article {
        animation: modalScaleIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .default-password-modal .modal-backdrop {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
        z-index: -1;
    }

    @keyframes modalFadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    @keyframes modalScaleIn {
        from {
            opacity: 0;
            transform: scale(0.95) translateY(-10px);
        }
        to {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
    }

    /* Light/Dark mode compatibility */
    [data-theme="light"] .default-password-modal article {
        background: #ffffff;
        color: #1a1a1a;
    }

    [data-theme="dark"] .default-password-modal article {
        background: var(--surface-primary);
        color: var(--text-primary);
    }

    /* Ensure text is readable in both themes */
    [data-theme="dark"] .default-password-modal li,
    [data-theme="dark"] .default-password-modal p {
        color: var(--ds-gray-400);
    }

    [data-theme="dark"] .default-password-modal strong {
        color: var(--ds-gray-200);
    }
</style>
