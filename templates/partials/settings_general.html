<div class="settings-panel">
    <h3>General Settings</h3>
    <hr>

    <form hx-post="/settings/general" hx-encoding="multipart/form-data" hx-swap="none">
        <label>
            <strong>App Name</strong>
            <input type="text" name="app_name" value="{{ settings.app_name|default('Sible') }}"
                placeholder="e.g. Sible Prod">
        </label>

        <label>
            <strong>Logo</strong>
            <input type="file" name="logo" accept="image/*" lang="en">
            {% if settings.logo_path %}
            <small>Current: <a href="{{ settings.logo_path }}" target="_blank">View Logo</a></small>
            {% endif %}
        </label>

        <label>
            <strong>Favicon</strong>
            <input type="file" name="favicon" accept=".ico,.png,.jpg,.jpeg" lang="en">
            {% if settings.favicon_path %}
            <small>Current: <a href="{{ settings.favicon_path }}" target="_blank">View Favicon</a></small>
            {% endif %}
        </label>

        <hr style="margin: 1.5rem 0;">
        <h4 style="margin-bottom: 0.5rem;">Infrastructure Configuration</h4>

        <label>
            <strong>Playbooks Path</strong>
            <div style="position: relative;">
                <input type="text" name="playbooks_path" value="{{ settings.playbooks_path|default('/app/playbooks') }}"
                    placeholder="/absolute/path/to/playbooks" hx-post="/settings/validate-path"
                    hx-trigger="keyup changed delay:500ms" hx-target="next .path-validation"
                    style="padding-left: 2.5rem;">
                <i data-lucide="folder" class="w-4 h-4"
                    style="position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%); opacity: 0.6; pointer-events: none;"></i>
            </div>
            <div class="path-validation"></div>
            <small>Absolute path where Sible will look for Ansible playbooks. (e.g.,
                <code>/app/playbooks</code>)</small>
        </label>

        <hr style="margin: 1.5rem 0;">
        <h4 style="margin-bottom: 0.5rem;">User Preferences</h4>

        <div class="settings-group">
            <label>Interface Theme</label>
            <select name="theme" hx-post="/settings/theme" hx-trigger="change" onchange="applyTheme(this.value)">
                <option value="light" {% if request.state.user.theme=='light' %}selected{% endif %}>Geist Light</option>
                <option value="dark" {% if request.state.user.theme=='dark' %}selected{% endif %}>Catppuccin Dark
                </option>
            </select>
            <small>Choose between a light or dark interface.</small>
        </div>

        <script>
            function applyTheme(val) {
                document.documentElement.setAttribute('data-theme', val);
            }
        </script>

        <label>
            <strong>Timezone</strong>
            <select name="timezone">
                {% set tz_list = [
                'UTC', 'UTC+1', 'UTC+2', 'UTC+3', 'UTC+4', 'UTC+5', 'UTC+6', 'UTC+7', 'UTC+8', 'UTC+9', 'UTC+10',
                'UTC+11', 'UTC+12',
                'UTC-1', 'UTC-2', 'UTC-3', 'UTC-4', 'UTC-5', 'UTC-6', 'UTC-7', 'UTC-8', 'UTC-9', 'UTC-10', 'UTC-11'
                ] %}
                {% for tz in tz_list %}
                <option value="{{ tz }}" {{ 'selected' if request.state.user.timezone==tz }}>{{ tz }}</option>
                {% endfor %}
            </select>
        </label>

        <div style="margin-top: 2rem; text-align: right;">
            <button type="submit" class="primary" style="width: auto;">Save General Settings</button>
        </div>
    </form>
</div>