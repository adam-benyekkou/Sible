<div class="h-100 flex-col">
    <header class="main-header">
        <div class="header-left">
            <span class="status-pill status-text-lg">IDLE</span>
            <h4>{{ name }}</h4>
        </div>
        <div class="actions">
            <!-- Edit (Visual only for now, maps to Editor tab) -->
            <button class="contrast" @click="currentTab = 'editor'">
                Edit
            </button>

            <!-- Run -->
            <button class="primary" hx-post="/run/{{ name }}">
                Run Playbook
            </button>

            <!-- Save -->
            <button class="contrast" @click="saveFile()">
                Save
            </button>

            <!-- Schedule -->
            <button class="contrast">
                Schedule
            </button>

            <!-- Delete Button -->
            <button class="danger" hx-delete="/playbook/{{ name }}"
                hx-confirm="Are you sure you want to delete {{ name }}? This cannot be undone."
                hx-target="#main-content">
                Delete
            </button>
        </div>
    </header>

    <div class="content-area">
        <!-- Editor Pane -->
        <div class="editor-pane">
            <div id="editor"></div>
        </div>

        <!-- Terminal Pane -->
        <div class="terminal-pane">
            <div id="terminal-container">
                <div class="waiting-text">Waiting for execution...</div>
            </div>
        </div>
    </div>
</div>

<!-- Hidden Form for HTMX/JS to store state -->
<textarea id="hidden-content" class="d-none">{{ content }}</textarea>

<script>
    (function () {
        function initAce() {
            var editorDiv = document.getElementById("editor");
            if (!editorDiv) return;

            // Prevent double init
            if (editorDiv.classList.contains("ace_editor")) return;

            // Wait for x-show / DOM paint
            setTimeout(function () {
                var editor = ace.edit("editor");
                editor.setTheme("ace/theme/tomorrow_night_eighties");
                editor.session.setMode("ace/mode/yaml");

                // Ensure text is visible
                editor.setShowPrintMargin(false);

                var contentArea = document.getElementById("hidden-content");
                if (contentArea) {
                    editor.setValue(contentArea.value, -1);
                }

                // Force resize
                editor.resize();

                // Save handler
                window.saveFile = function () {
                    var content = editor.getValue();
                    htmx.ajax('POST', '/playbook/{{ name }}', {
                        values: { content: content },
                        swap: 'none'
                    }).then(() => {
                        // Optional toast
                    });
                };
            }, 100);
        }

        // Run Init
        initAce();
    })();
</script>