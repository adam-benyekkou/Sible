<div class="settings-panel">
    <h3>Notifications</h3>
    <p class="color-muted">Get alerted when your playbooks run.</p>
    <hr>

    <form hx-post="/settings/notifications" hx-swap="none">

        <!-- Global Settings Section -->
        <div class="settings-section" style="margin-bottom: 2rem;">
            <label>
                <strong style="color: var(--text-primary);">Apprise URL / Config URL</strong>
                <small style="color: var(--text-muted);">Supports service URLs (discord://, tgram://) and remote config
                    URLs (https://...). See <a href="https://github.com/caronc/apprise" target="_blank">Apprise
                        Docs</a>.</small>
                <input type="password" name="apprise_url"
                    placeholder="discord://webhook_id/token or https://apprise.example.com/cfg/..."
                    value="{{ settings.apprise_url }}"
                    style="background: var(--surface-secondary); color: var(--text-primary); border: 1px solid var(--border-subtle);">
            </label>

            <div class="grid" style="margin-top: 1rem;">
                <label>
                    <strong style="color: var(--text-primary);">Notify on Success ðŸŸ¢</strong>
                    <select name="notify_on_success"
                        style="background: var(--surface-secondary); color: var(--text-primary); border: 1px solid var(--border-subtle);">
                        <option value="true" {% if settings.notify_on_success %}selected{% endif %}>Enabled</option>
                        <option value="false" {% if not settings.notify_on_success %}selected{% endif %}>Disabled
                        </option>
                    </select>
                </label>
                <label>
                    <strong style="color: var(--text-primary);">Notify on Failure ðŸ”´</strong>
                    <select name="notify_on_failure"
                        style="background: var(--surface-secondary); color: var(--text-primary); border: 1px solid var(--border-subtle);">
                        <option value="true" {% if settings.notify_on_failure %}selected{% endif %}>Enabled</option>
                        <option value="false" {% if not settings.notify_on_failure %}selected{% endif %}>Disabled
                        </option>
                    </select>
                </label>
            </div>
        </div>

        <hr>

        <!-- Per-Playbook Overrides Section -->
        <h5 style="margin-top: 1.5rem;">Per-Playbook Overrides</h5>
        <p class="color-muted" style="font-size: 0.9rem;">Set specific notification rules for individual playbooks.</p>

        <table class="striped" style="margin-top: 1rem;">
            <thead>
                <tr>
                    <th>Playbook</th>
                    <th style="width: 140px; text-align: center;" title="Notify on Success">ðŸŸ¢ Success</th>
                    <th style="width: 140px; text-align: center;" title="Notify on Failure">ðŸ”´ Failure</th>
                </tr>
            </thead>
            <tbody>
                {% for pb in playbooks %}
                <tr style="border-bottom: 1px solid var(--border-subtle);">
                    <td style="color: var(--text-primary);">{{ pb.name }}</td>
                    <td style="text-align: center;">
                        <select name="notify_success_{{ pb.name }}"
                            style="margin-bottom: 0; padding: 2px 4px; height: auto; font-size: 12px; background: var(--surface-primary); color: var(--text-primary); border: 1px solid var(--border-subtle);">
                            <option value="" {% if pb.notify_on_success==None %}selected{% endif %}>Inherit</option>
                            <option value="true" {% if pb.notify_on_success==True %}selected{% endif %}>Enable</option>
                            <option value="false" {% if pb.notify_on_success==False %}selected{% endif %}>Disable
                            </option>
                        </select>
                    </td>
                    <td style="text-align: center;">
                        <select name="notify_failure_{{ pb.name }}"
                            style="margin-bottom: 0; padding: 2px 4px; height: auto; font-size: 12px; background: var(--surface-primary); color: var(--text-primary); border: 1px solid var(--border-subtle);">
                            <option value="" {% if pb.notify_on_failure==None %}selected{% endif %}>Inherit</option>
                            <option value="true" {% if pb.notify_on_failure==True %}selected{% endif %}>Enable</option>
                            <option value="false" {% if pb.notify_on_failure==False %}selected{% endif %}>Disable
                            </option>
                        </select>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Action Buttons -->
        {% if request.state.user.role == 'admin' %}
        <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: flex-end;">
            <button type="button" class="contrast" hx-post="/settings/test-notification" style="width: auto;">Test
                Notification</button>
            <button type="submit" class="primary" style="width: auto;">Save Configuration</button>
        </div>
        {% endif %}
    </form>
</div>