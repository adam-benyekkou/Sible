<div class="settings-panel">
    <h3>Retention Policies</h3>
    <p class="color-muted">Configure how long logs and history records are kept.</p>
    <hr>

    <form hx-post="/settings/retention" hx-swap="none">
        <div class="grid">
            <label>
                <strong style="color: var(--text-primary);">Global Retention (Days)</strong>
                <input type="number" name="global_retention" value="{{ global_retention }}" required min="1"
                    {{ 'disabled' if request.state.user.role=='watcher' }}
                    style="background: var(--surface-secondary); color: var(--text-primary); border: 1px solid var(--border-subtle);">
            </label>
            <label>
                <strong style="color: var(--text-primary);">Global Max Logs (Count)</strong>
                <small style="color: var(--text-muted);">Keep at most this many logs per playbook.</small>
                <input type="number" name="global_max_runs" value="{{ global_max_runs }}" required min="1" {{ 'disabled'
                    if request.state.user.role=='watcher' }}
                    style="background: var(--surface-secondary); color: var(--text-primary); border: 1px solid var(--border-subtle);">
            </label>
        </div>


        <hr>

        <h5>Per-Playbook Overrides</h5>
        <small class="color-muted">Set specific retention rules for individual playbooks.</small>

        <table class="striped" style="margin-top: 1rem;">
            <thead>
                <tr>
                    <th>Playbook</th>
                    <th>Retention (Days)</th>
                    <th>Max Logs</th>
                </tr>
            </thead>
            <tbody>
                {% for pb in playbooks %}
                <tr style="border-bottom: 1px solid var(--border-subtle);">
                    <td style="color: var(--text-primary);">{{ pb.name }}</td>
                    <td>
                        <input type="number" name="retention_{{ pb.name }}" value="{{ pb.retention }}"
                            placeholder="Global ({{ global_retention }})"
                            style="margin-bottom: 0; background: var(--surface-primary); color: var(--text-primary); border: 1px solid var(--border-subtle);"
                            {{ 'disabled' if request.state.user.role=='watcher' }}>
                    </td>
                    <td>
                        <input type="number" name="max_runs_{{ pb.name }}" value="{{ pb.max_runs }}"
                            placeholder="Global ({{ global_max_runs }})"
                            style="margin-bottom: 0; background: var(--surface-primary); color: var(--text-primary); border: 1px solid var(--border-subtle);"
                            {{ 'disabled' if request.state.user.role=='watcher' }}>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        {% if request.state.user.role == 'admin' %}
        <div style="margin-top: 2rem; text-align: right;">
            <button type="submit" class="primary" style="width: auto;">Save Retention Settings</button>
        </div>
        {% endif %}
    </form>
</div>