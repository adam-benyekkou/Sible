<tr class="playbook-row"
    onclick="if(!event.target.closest('.breadcrumb-link') && !event.target.closest('button')){ htmx.ajax('GET', '/playbooks/{{ playbook.path | safe }}', {target: '#main-content', pushUrl: true}) }"
    style="border-bottom: 1px solid var(--border-subtle);">

    <td style="padding: 20px 0 20px 24px; vertical-align: middle; width: 80px;">
        {% include "partials/favorite_icon.html" %}
    </td>
    <td style="padding: 20px 0; vertical-align: middle; width: 120px;">
        <div style="display: flex; align-items: center; min-width: 100px;">
            {% if playbook.last_job_id and (playbook.status == 'failed' or playbook.status == 'success') %}
            <button class="status-btn"
                @click.stop="htmx.ajax('GET', '/history/run/{{ playbook.last_job_id }}', {target: 'body', swap: 'beforeend'})"
                title="View Last Logs">
                <span class="badge {{ 'badge-failed' if playbook.status == 'failed' else 'badge-success' }}">
                    {{ playbook.status }}
                </span>
            </button>
            {% else %}
            <span class="badge badge-secondary" style="text-transform: capitalize;">
                {{ playbook.status | replace('_', ' ') }}
            </span>
            {% endif %}
        </div>
    </td>
    <td style="padding: 20px 0; vertical-align: middle;">
        <div style="display: flex; flex-direction: column;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 2px;">
                <span style="font-weight: 600; color: var(--text-primary); font-size: 14px;">{{ playbook.name }}</span>

                <div class="quick-actions" style="display: flex; gap: 4px; opacity: 0; transition: opacity 0.2s;">
                    <button class="action-btn" title="Run Playbook"
                        hx-get="/api/playbooks/run-modal/{{ playbook.path | safe }}" hx-target="body"
                        hx-swap="beforeend" onclick="event.stopPropagation()">
                        <i data-lucide="play" style="width: 14px; height: 14px;"></i>
                    </button>
                </div>
            </div>
            <div style="font-family: 'Geist Mono', monospace; font-size: 11px; color: var(--text-muted);">
                {% if playbook.folder %}
                {% set folders = playbook.path.split('/')[:-1] %}
                {% for folder in folders %}
                <a href="#" class="breadcrumb-link"
                    onclick="event.stopPropagation(); document.getElementById('playbook-search').value='{{ folder }}'; htmx.trigger('#playbook-search', 'keyup'); return false;">{{
                    folder }}</a> /
                {% endfor %}
                {% endif %}{{ playbook.path.split('/')[-1] }}
            </div>
        </div>
    </td>
    <td style="padding: 20px 0; vertical-align: middle;">
        <div x-data="{ hoverTask: false }" style="position: relative;">
            <div style="color: var(--text-muted); font-size: 14px; max-width: 300px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; cursor: help;"
                @mouseenter="hoverTask = true" @mouseleave="hoverTask = false">
                {{ playbook.description }}
            </div>
            <div x-show="hoverTask" x-transition
                style="position: absolute; top: 100%; left: 0; background: var(--surface-primary); border: 1px solid var(--border-subtle); padding: 12px; border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); z-index: 50; width: 320px; color: var(--text-primary); font-size: 13px; line-height: 1.5;">
                {{ playbook.description }}
            </div>
        </div>

    </td>
    <td style="padding: 20px 0; vertical-align: middle;">
        <div style="display: flex; align-items: center; gap: 8px;" x-data="{ showTooltip: false }">
            {% if playbook.author == 'System' %}
            <i data-lucide="clock" style="width: 14px; height: 14px; color: var(--text-muted);"
                @mouseenter="showTooltip = true" @mouseleave="showTooltip = false"></i>
            {% else %}
            <div @mouseenter="showTooltip = true" @mouseleave="showTooltip = false"
                style="width: 20px; height: 20px; border-radius: 50%; background: var(--surface-secondary); display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 600; color: var(--text-muted); cursor: help;">
                {{ playbook.author[0] | upper if playbook.author else 'S' }}
            </div>
            {% endif %}
            <span style="font-size: 13px; color: var(--text-primary); position: relative;">
                {{ playbook.author }}
                <div x-show="showTooltip"
                    style="position: absolute; bottom: 100%; left: 0; background: var(--surface-secondary); color: var(--text-primary); border: 1px solid var(--border-subtle); padding: 4px 8px; border-radius: 4px; font-size: 11px; white-space: nowrap; z-index: 10; margin-bottom: 4px;"
                    x-transition>
                    {{ playbook.author }}
                </div>
            </span>

        </div>
    </td>
    <td style="padding: 20px 24px 20px 0; vertical-align: middle; text-align: right;">
        <div style="display: flex; flex-direction: column; align-items: flex-end;">
            <span style="font-size: 13px; color: var(--text-primary); font-weight: 500;">{{ playbook.last_run }}</span>

            {% if playbook.duration %}
            <span style="font-size: 11px; color: var(--text-muted);">{{ playbook.duration }}</span>
            {% endif %}
        </div>
    </td>
</tr>