<div class="sidebar-btn-container">
    <button class="btn-new" hx-post="/playbook" hx-prompt="Enter new playbook name (e.g., install-nginx.yaml):"
        hx-swap="none">
        + New Playbook
    </button>
</div>

{% macro render_tree(items) %}
{% for item in items %}
{% if item.type == 'directory' %}
<details class="sidebar-folder">
    <summary class="folder-title">
        <span class="folder-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round" style="color: var(--ds-gray-600);">
                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
            </svg>
        </span> {{ item.name }}
    </summary>
    <div class="folder-content">
        {{ render_tree(item.children) }}
    </div>
</details>
{% else %}
<div class="playbook-item" hx-get="/playbook/{{ item.path }}" hx-target="#main-content" hx-swap="innerHTML">
    <span class="status-dot {{ item.status }}"></span>
    {{ item.name }}
</div>
{% endif %}
{% endfor %}
{% endmacro %}

{% if not playbooks %}
<div class="empty-state-message">No playbooks found.</div>
{% else %}
<details class="sidebar-folder" open>
    <summary class="folder-title">
        <span class="folder-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round" style="color: var(--ds-gray-600);">
                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
            </svg>
        </span>
        Playbooks
    </summary>
    <div class="folder-content">
        {{ render_tree(playbooks) }}
    </div>
</details>
{% endif %}
{% set settings = get_settings() %}
{% if settings.auth_enabled %}
<div style="margin-top: 1rem; border-top: 1px solid var(--ds-gray-200); padding-top: 1rem;">
    <a href="/logout" class="playbook-item" style="color: var(--ds-danger);">
        <span class="folder-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
        </span>
        Logout
    </a>
</div>
{% endif %}