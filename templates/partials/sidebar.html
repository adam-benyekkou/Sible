{% if request.state.user.role == 'admin' %}
<div class="sidebar-btn-container">
    <button class="btn-new" @click="$dispatch('open-new-playbook-modal')" style="width: 100%;">
        <i data-lucide="plus-circle" style="width: 14px; height: 14px; margin-right: 6px;"></i> New Playbook
    </button>
</div>
{% endif %}



{% macro render_tree(items) %}
{% for item in items %}
{% if item.type == 'directory' %}
<details class="sidebar-folder">
    <summary class="folder-title">
        <span class="folder-icon">
            <span class="folder-icon">
                <i data-lucide="folder"></i>
            </span> {{ item.name }}
    </summary>
    <div class="folder-content">
        {{ render_tree(item.children) }}
    </div>
</details>
{% else %}
<div class="playbook-item" hx-get="/playbooks/{{ item.path | safe }}" hx-target="#main-content" hx-swap="innerHTML"
    hx-push-url="true">
    <span class="status-dot {{ item.status }}"></span>
    {{ item.name }}
</div>
{% endif %}
{% endfor %}
{% endmacro %}

{% if not playbooks %}
<div class="empty-state-message" style="padding: 2rem 1rem; text-align: center; color: var(--ds-gray-600);">
    <p style="font-size: 0.9rem; margin-bottom: 1rem;">No playbooks yet.</p>
    {% if request.state.user.role == 'admin' %}
    <button class="btn-new" style="width: 100%; font-size: 0.8rem;" @click="$dispatch('open-new-playbook-modal')">
        <i data-lucide="plus" style="width: 14px; height: 14px; margin-right: 6px;"></i> Create One
    </button>
    {% endif %}
</div>
{% else %}
<details class="sidebar-folder" open>
    <summary class="folder-title">
        <span class="folder-icon">
            <span class="folder-icon">
                <i data-lucide="folder"></i>
            </span>
        </span>
        Playbooks
    </summary>
    <div class="folder-content">
        {{ render_tree(playbooks) }}
    </div>
</details>
{% endif %}
{% set settings = get_settings() %}
{% if settings.auth_enabled %}
<div style="margin-top: 1rem; border-top: 1px solid var(--ds-gray-200); padding-top: 1rem;">
    <a href="/logout" class="playbook-item" style="color: var(--ds-danger);">
        <span class="folder-icon">
            <span class="folder-icon">
                <i data-lucide="log-out"></i>
            </span>
            Logout
    </a>
</div>
{% endif %}

<div
    style="margin-top: auto; padding: 1rem 0; border-top: 1px solid var(--ds-gray-200); color: var(--ds-gray-400); font-size: 0.75rem; display: flex; justify-content: space-between; align-items: center;">
    <span style="font-weight: 500;">v1.0.0</span>
    {% if request.state.user %}
    <span style="opacity: 0.7;">{{ request.state.user.username }}</span>
    {% endif %}
</div>