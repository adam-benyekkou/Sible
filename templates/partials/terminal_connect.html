<div class="log-meta" style="display: flex; justify-content: space-between; align-items: center;">
    <span>Connecting to stream for {{ name }}...</span>
    <button type="button" class="secondary" hx-post="/stop/{{ name }}" hx-swap="none"
        style="padding: 2px 8px; font-size: 0.75rem; height: auto; background-color: #ef4444; border: 1px solid #dc2626; color: white; border-radius: 4px; cursor: pointer;">
        Stop
    </button>
</div>

<!-- Stream Controller: Manages SSE connection and self-destructs on 'end' -->
<div id="stream-controller" hx-ext="sse"
    sse-connect="/stream/{{ name | safe }}?mode={{ mode|default('run') }}&limit={{ limit|default('') }}&tags={{ tags|default('') }}&verbosity={{ verbosity|default(0) }}&extra_vars={{ extra_vars|default('') }}">
    <!-- 1. Log Lines: Append to the main container -->
    <div sse-swap="message" hx-target="#terminal-container" hx-swap="beforeend"></div>

    <!-- 2. End Signal: Remove this controller (stops reconnection) -->
    <div sse-swap="end" hx-target="#stream-controller" hx-swap="delete"></div>
</div>

<!-- Auto-scroll script -->
<script>
    (function () {
        var container = document.getElementById("terminal-container");
        if (container) {
            var observer = new MutationObserver(function () {
                container.scrollTop = container.scrollHeight;
            });
            observer.observe(container, { childList: true, subtree: true });
        }
    })();
</script>